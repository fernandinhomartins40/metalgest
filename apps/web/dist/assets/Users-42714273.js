import{c as x,d as M,R as i,r as q,j as e,B as o,f as B}from"./index-3e5870c5.js";import{u as V}from"./index.esm-04cc717d.js";import{o as G,s as u,e as I,T as O,a as X,b as g,c as v,t as _}from"./tabs-21993d5d.js";import{C as y,b as N,c as w,d as S,a as b}from"./card-0f409810.js";import{P as H,C as J}from"./confirm-dialog-8a944b73.js";import{u as n,D as K}from"./useApi-5cb55952.js";import{a as c}from"./api-a6c5b2a0.js";import{X as Q}from"./x-circle-f3df33b9.js";import{f as W}from"./index-0bd7da91.js";import{U as Y}from"./user-plus-b4274dd5.js";const Z=x("CheckCircle2",[["path",{d:"M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z",key:"14v8dr"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),ee=x("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),se=x("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),re=x("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),ae=G({name:u().min(3,"Nome deve ter no mínimo 3 caracteres"),email:u().email("E-mail inválido"),password:u().min(6,"Senha deve ter no mínimo 6 caracteres"),confirmPassword:u(),role:I(["admin","financeiro","comercial","producao"],{required_error:"Selecione um cargo"})}).refine(t=>t.password===t.confirmPassword,{message:"Senhas não conferem",path:["confirmPassword"]});function je(){const{toast:t}=M(),[C,U]=i.useState([]),[h,k]=i.useState(""),[l,P]=i.useState("all");i.useState(null),i.useState(!1);const[d,j]=i.useState({open:!1,title:"",description:"",action:null}),{execute:T,loading:te}=n(c.users.list),{execute:E,loading:f}=n(c.users.create);n(c.users.update);const{execute:L,loading:z}=n(c.users.toggleStatus),{execute:D,loading:ie}=n(c.users.resetPassword),r=V({resolver:_(ae),defaultValues:{name:"",email:"",password:"",confirmPassword:"",role:"producao"}});q.useEffect(()=>{p()},[]);const p=async()=>{try{const s=await T();U(s)}catch(s){console.error("Error loading users:",s)}},F=async s=>{try{await E(s),t({title:"Usuário cadastrado com sucesso!",description:`${s.name} foi adicionado como ${s.role}.`}),r.reset(),p()}catch(a){console.error("Error creating user:",a),t({variant:"destructive",title:"Erro ao cadastrar usuário",description:a.message})}},$=async s=>{const a=!s.active;j({open:!0,title:`${a?"Ativar":"Desativar"} usuário`,description:`Tem certeza que deseja ${a?"ativar":"desativar"} o usuário ${s.name}?`,action:async()=>{try{await L(s.id,a),t({title:`Usuário ${a?"ativado":"desativado"}`,description:"O status do usuário foi alterado com sucesso."}),p()}catch(m){console.error("Error toggling user status:",m),t({variant:"destructive",title:"Erro ao alterar status",description:m.message})}}})},A=async s=>{try{await D(s),t({title:"Link de recuperação enviado",description:`Um e-mail foi enviado para ${s} com as instruções.`})}catch(a){console.error("Error resetting password:",a),t({variant:"destructive",title:"Erro ao resetar senha",description:a.message})}},R=C.filter(s=>{const a=s.name.toLowerCase().includes(h.toLowerCase())||s.email.toLowerCase().includes(h.toLowerCase()),m=l==="all"||l==="active"&&s.active||l==="inactive"&&!s.active;return a&&m});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Usuários"}),e.jsx("p",{className:"text-muted-foreground",children:"Gerencie os usuários do sistema"})]}),e.jsxs(O,{defaultValue:"list",className:"space-y-4",children:[e.jsxs(X,{children:[e.jsx(g,{value:"list",children:"Lista de Usuários"}),e.jsx(g,{value:"new",children:"Novo Usuário"})]}),e.jsx(v,{value:"list",children:e.jsxs(y,{children:[e.jsxs(N,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(w,{children:"Usuários do Sistema"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{variant:"outline",size:"sm",children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Filtrar"]}),e.jsxs(o,{variant:"outline",size:"sm",children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Exportar"]})]})]}),e.jsx(S,{children:"Gerencie os usuários e suas permissões"})]}),e.jsx(b,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(B,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar usuários...",className:"w-full pl-10 pr-4 py-2 text-sm bg-gray-50 rounded-lg border border-gray-200",value:h,onChange:s=>k(s.target.value)})]}),e.jsxs("select",{className:"px-3 py-2 text-sm bg-gray-50 rounded-lg border border-gray-200",value:l,onChange:s=>P(s.target.value),children:[e.jsx("option",{value:"all",children:"Todos"}),e.jsx("option",{value:"active",children:"Ativos"}),e.jsx("option",{value:"inactive",children:"Inativos"})]})]}),e.jsx("div",{className:"space-y-4",children:R.map(s=>e.jsxs("div",{className:"p-4 rounded-lg border border-gray-200 hover:border-primary/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-r from-primary to-secondary flex items-center justify-center text-white font-medium",children:s.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email}),e.jsx("span",{className:"inline-flex items-center px-2 py-1 mt-1 text-xs font-medium rounded-full bg-gray-100",children:s.role})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(o,{variant:"ghost",size:"sm",onClick:()=>A(s.email),children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Resetar Senha"]}),e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>$(s),disabled:z,children:s.active?e.jsx(Z,{className:"h-4 w-4 text-green-500"}):e.jsx(Q,{className:"h-4 w-4 text-red-500"})}),e.jsx(o,{variant:"ghost",size:"sm",children:e.jsx(H,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"mt-4 flex items-center text-sm text-gray-500",children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Criado em: ",W(new Date(s.created_at),"dd/MM/yyyy")]})]},s.id))})]})})]})}),e.jsx(v,{value:"new",children:e.jsxs(y,{children:[e.jsxs(N,{children:[e.jsx(w,{children:"Cadastrar Novo Usuário"}),e.jsx(S,{children:"Adicione um novo usuário ao sistema"})]}),e.jsx(b,{children:e.jsxs("form",{onSubmit:r.handleSubmit(F),className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Nome Completo *"}),e.jsx("input",{...r.register("name"),className:"w-full rounded-md border p-2"}),r.formState.errors.name&&e.jsx("span",{className:"text-sm text-red-500",children:r.formState.errors.name.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"E-mail *"}),e.jsx("input",{type:"email",...r.register("email"),className:"w-full rounded-md border p-2"}),r.formState.errors.email&&e.jsx("span",{className:"text-sm text-red-500",children:r.formState.errors.email.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Senha *"}),e.jsx("input",{type:"password",...r.register("password"),className:"w-full rounded-md border p-2"}),r.formState.errors.password&&e.jsx("span",{className:"text-sm text-red-500",children:r.formState.errors.password.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Confirmar Senha *"}),e.jsx("input",{type:"password",...r.register("confirmPassword"),className:"w-full rounded-md border p-2"}),r.formState.errors.confirmPassword&&e.jsx("span",{className:"text-sm text-red-500",children:r.formState.errors.confirmPassword.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Cargo *"}),e.jsxs("select",{...r.register("role"),className:"w-full rounded-md border p-2",children:[e.jsx("option",{value:"",children:"Selecione..."}),e.jsx("option",{value:"admin",children:"Administrador"}),e.jsx("option",{value:"financeiro",children:"Financeiro"}),e.jsx("option",{value:"comercial",children:"Comercial"}),e.jsx("option",{value:"producao",children:"Produção"})]}),r.formState.errors.role&&e.jsx("span",{className:"text-sm text-red-500",children:r.formState.errors.role.message})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(o,{type:"submit",disabled:f,children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),f?"Cadastrando...":"Cadastrar Usuário"]})})]})})]})})]}),e.jsx(J,{open:d.open,onOpenChange:s=>j(a=>({...a,open:s})),title:d.title,description:d.description,onConfirm:d.action})]})}export{je as default};
