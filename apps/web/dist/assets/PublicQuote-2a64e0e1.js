import{I as N,d as v,r as x,j as e,L as C,B as p,F as w}from"./index-15ba3699.js";import{C as f,b as j,c as y,a as g}from"./card-2f14c19d.js";import{a as b}from"./api-212ec7ce.js";import{E}from"./jspdf.plugin.autotable-b3078b9d.js";import{f as F}from"./index-0bd7da91.js";import{X as R}from"./x-circle-70f6c6e6.js";import{C as P}from"./check-circle-263b8222.js";const B={generateQuote:(r,i={hideCosts:!1})=>{var m,c,u,l,o,h;const a=new E;(m=r.company)!=null&&m.logo&&a.addImage(r.company.logo,"JPEG",10,10,50,20),a.setFontSize(20),a.text("Orçamento",105,20,{align:"center"}),a.setFontSize(12),a.text(`#${r.id.substring(0,8)}`,105,30,{align:"center"}),a.setFontSize(10),a.text([((c=r.company)==null?void 0:c.name)||"Sua Empresa",((u=r.company)==null?void 0:u.address)||"Endereço da Empresa",((l=r.company)==null?void 0:l.phone)||"Telefone da Empresa",((o=r.company)==null?void 0:o.email)||"Email da Empresa"],10,45),a.text("Cliente:",10,75),a.text([r.client.name,`${r.client.street}, ${r.client.number}`,`${r.client.city} - ${r.client.state}`,`Tel: ${r.client.phone}`],10,80),a.text("Data:",150,75),a.text(F(new Date(r.created_at),"dd/MM/yyyy"),150,80);const n=[{header:"Item",dataKey:"name"},{header:"Qtd",dataKey:"quantity"},{header:"Valor Unit.",dataKey:"unitPrice"},{header:"Total",dataKey:"total"}],s=r.items.map(t=>({name:t.product.name,quantity:t.quantity,unitPrice:i.hideCosts?"---":new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t.unitPrice),total:i.hideCosts?"---":new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t.quantity*t.unitPrice)}));return a.autoTable({head:[n.map(t=>t.header)],body:s.map(t=>n.map(d=>t[d.dataKey])),startY:100,styles:{fontSize:8},headStyles:{fillColor:[66,66,66]}}),i.hideCosts||a.text(`Total: ${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(r.total_value)}`,150,a.autoTable.previous.finalY+10,{align:"right"}),a.setFontSize(8),a.text(["Condições:","- Validade: 15 dias","- Prazo de entrega: A combinar","- Forma de pagamento: A combinar",((h=r.company)==null?void 0:h.terms)||""],10,a.autoTable.previous.finalY+20),a}};function z(){const{token:r}=N(),{toast:i}=v(),[a,n]=x.useState(!0),[s,m]=x.useState(null),[c,u]=x.useState(null);x.useEffect(()=>{l()},[r]);const l=async()=>{try{n(!0);const t=await b.quotes.getPublicQuote(r);m(t)}catch(t){console.error("Error loading quote:",t),u(t.message),i({title:"Erro",description:t.message||"Ocorreu um erro ao carregar o orçamento.",variant:"destructive"})}finally{n(!1)}},o=async t=>{try{n(!0),await b.quotes.updatePublicQuoteResponse(r,{status:t,comments:""}),i({title:"Resposta registrada",description:t==="approved"?"Orçamento aprovado com sucesso!":"Orçamento rejeitado."}),l()}catch(d){console.error("Error updating response:",d),i({title:"Erro",description:"Ocorreu um erro ao registrar sua resposta.",variant:"destructive"})}finally{n(!1)}},h=async()=>{try{n(!0),B.generateQuote(s,{hideCosts:!0}).save(`orcamento-${s.id.substring(0,8)}.pdf`)}catch(t){console.error("Error generating PDF:",t),i({title:"Erro",description:"Ocorreu um erro ao gerar o PDF.",variant:"destructive"})}finally{n(!1)}};return a?e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx(C,{size:"lg"})}):c?e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsxs(f,{className:"w-full max-w-lg",children:[e.jsx(j,{children:e.jsx(y,{className:"text-red-500",children:"Erro"})}),e.jsx(g,{children:e.jsx("p",{children:c})})]})}):e.jsx("div",{className:"container mx-auto py-8 px-4",children:e.jsxs(f,{children:[e.jsx(j,{children:e.jsxs(y,{children:["Orçamento #",s.id.substring(0,8)]})}),e.jsxs(g,{className:"space-y-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Cliente"}),e.jsx("p",{children:s.client.name}),e.jsx("p",{children:s.client.email})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Data"}),e.jsx("p",{children:new Date(s.created_at).toLocaleDateString()})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:"Descrição"}),e.jsx("p",{children:s.description})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-2",children:"Item"}),e.jsx("th",{className:"text-left p-2",children:"Quantidade"}),e.jsx("th",{className:"text-right p-2",children:"Valor"})]})}),e.jsx("tbody",{children:s.items.map((t,d)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"p-2",children:t.product.name}),e.jsx("td",{className:"p-2",children:t.quantity}),e.jsx("td",{className:"p-2 text-right",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t.quantity*t.unitPrice)})]},d))}),e.jsx("tfoot",{children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:"2",className:"p-2 text-right font-semibold",children:"Total:"}),e.jsx("td",{className:"p-2 text-right font-semibold",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s.total_value)})]})})]})}),e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:justify-between items-center",children:[e.jsxs(p,{variant:"outline",onClick:h,disabled:a,children:[e.jsx(w,{className:"h-4 w-4 mr-2"}),"Baixar PDF"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{variant:"destructive",onClick:()=>o("rejected"),disabled:a,children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Rejeitar"]}),e.jsxs(p,{variant:"default",onClick:()=>o("approved"),disabled:a,children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Aprovar"]})]})]})]})]})})}export{z as default};
