import{j as e,B as v,P as R,W as I,d as V,R as n,L as _}from"./index-15ba3699.js";import{o as G,s as f,e as H,n as w,d as K,t as U,T as W,a as X,b as T,c as k}from"./tabs-1121ec05.js";import{D as Y,u as C}from"./useApi-25c4a2da.js";import{a as S}from"./api-212ec7ce.js";import{u as Q}from"./index.esm-853230a7.js";import{C as h,b as j,c as p,a as g,d as $}from"./card-2f14c19d.js";import{T as J}from"./tag-d60cab13.js";import{P as Z,T as ee}from"./trash-2-139a187c.js";import{A as se,B as ae}from"./BarChart-53017f19.js";import{P as te,C as re}from"./confirm-dialog-42edc79a.js";import{R as ie,C as oe,X as ce,Y as le,T as ne,B as de}from"./generateCategoricalChart-fe6d85a2.js";import{f as me}from"./index-0bd7da91.js";import"./isEqual-ca34b85f.js";const xe=G({name:f().min(3,"Nome deve ter no mínimo 3 caracteres"),type:H(["product","service"]),unit:f().min(1,"Unidade é obrigatória"),costPrice:w().min(0,"Preço de custo deve ser maior ou igual a 0"),suggestedPrice:w().min(0,"Preço sugerido deve ser maior ou igual a 0"),stock:w().min(0,"Estoque deve ser maior ou igual a 0"),minStock:w().min(0,"Estoque mínimo deve ser maior ou igual a 0"),category:f().min(1,"Categoria é obrigatória"),description:f().optional(),tags:K(f()).optional()}),ue=["Matéria-prima","Ferramenta","Acessório","Serviço","Outro"];function he({onSubmit:c}){const{register:r,handleSubmit:l,watch:i,setValue:d,reset:m,formState:{errors:a}}=Q({resolver:U(xe),defaultValues:{type:"product",tags:[],stock:0,minStock:0}}),x=i("type"),s=async t=>{await c(t),m()};return e.jsxs(h,{children:[e.jsx(j,{children:e.jsx(p,{children:"Novo Item"})}),e.jsx(g,{children:e.jsxs("form",{onSubmit:l(s),className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Nome *"}),e.jsx("input",{...r("name"),className:"w-full rounded-md border p-2"}),a.name&&e.jsx("span",{className:"text-sm text-red-500",children:a.name.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Tipo *"}),e.jsxs("select",{...r("type"),className:"w-full rounded-md border p-2",children:[e.jsx("option",{value:"product",children:"Produto"}),e.jsx("option",{value:"service",children:"Serviço"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Unidade *"}),e.jsx("input",{...r("unit"),className:"w-full rounded-md border p-2",placeholder:"kg, m², unidade..."}),a.unit&&e.jsx("span",{className:"text-sm text-red-500",children:a.unit.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Categoria *"}),e.jsxs("select",{...r("category"),className:"w-full rounded-md border p-2",children:[e.jsx("option",{value:"",children:"Selecione..."}),ue.map(t=>e.jsx("option",{value:t,children:t},t))]}),a.category&&e.jsx("span",{className:"text-sm text-red-500",children:a.category.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Preço de Custo *"}),e.jsx("input",{type:"number",step:"0.01",...r("costPrice",{valueAsNumber:!0}),className:"w-full rounded-md border p-2"}),a.costPrice&&e.jsx("span",{className:"text-sm text-red-500",children:a.costPrice.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Preço Sugerido *"}),e.jsx("input",{type:"number",step:"0.01",...r("suggestedPrice",{valueAsNumber:!0}),className:"w-full rounded-md border p-2"}),a.suggestedPrice&&e.jsx("span",{className:"text-sm text-red-500",children:a.suggestedPrice.message})]}),x==="product"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Estoque Atual *"}),e.jsx("input",{type:"number",...r("stock",{valueAsNumber:!0}),className:"w-full rounded-md border p-2"}),a.stock&&e.jsx("span",{className:"text-sm text-red-500",children:a.stock.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Estoque Mínimo *"}),e.jsx("input",{type:"number",...r("minStock",{valueAsNumber:!0}),className:"w-full rounded-md border p-2"}),a.minStock&&e.jsx("span",{className:"text-sm text-red-500",children:a.minStock.message})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Descrição"}),e.jsx("textarea",{...r("description"),className:"w-full rounded-md border p-2",rows:3})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(v,{type:"button",variant:"outline",size:"sm",onClick:()=>{const t=i("tags")||[];d("tags",[...t,"promoção"])},children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Promoção"]}),e.jsxs(v,{type:"button",variant:"outline",size:"sm",onClick:()=>{const t=i("tags")||[];d("tags",[...t,"novo"])},children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Novo"]}),e.jsxs(v,{type:"button",variant:"outline",size:"sm",onClick:()=>{const t=i("tags")||[];d("tags",[...t,"esgotado"])},children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Esgotado"]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(v,{type:"submit",children:"Cadastrar Item"})})]})})]})}const je=["Matéria-prima","Ferramenta","Acessório","Serviço","Outro"];function pe({products:c,onDelete:r,searchTerm:l,setSearchTerm:i,selectedCategory:d,setSelectedCategory:m,stockFilter:a,setStockFilter:x}){return e.jsxs(h,{children:[e.jsx(j,{children:e.jsx(p,{children:"Catálogo"})}),e.jsx(g,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsx("div",{children:e.jsx("input",{type:"text",placeholder:"Buscar...",className:"w-full rounded-md border p-2",value:l,onChange:s=>i(s.target.value)})}),e.jsx("div",{children:e.jsxs("select",{className:"w-full rounded-md border p-2",value:d,onChange:s=>m(s.target.value),children:[e.jsx("option",{value:"all",children:"Todas Categorias"}),je.map(s=>e.jsx("option",{value:s,children:s},s))]})}),e.jsx("div",{children:e.jsxs("select",{className:"w-full rounded-md border p-2",value:a,onChange:s=>x(s.target.value),children:[e.jsx("option",{value:"all",children:"Todos"}),e.jsx("option",{value:"low",children:"Estoque Baixo"}),e.jsx("option",{value:"out",children:"Sem Estoque"})]})}),e.jsx("div",{children:e.jsxs(v,{className:"w-full",variant:"outline",children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Exportar"]})})]}),e.jsx("div",{className:"space-y-4",children:c.map(s=>e.jsxs("div",{className:"border rounded-lg p-4 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold flex items-center gap-2",children:[s.type==="product"?e.jsx(R,{className:"h-4 w-4"}):e.jsx(I,{className:"h-4 w-4"}),s.name]}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.category," • ",s.unit]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[s.type==="product"&&e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-medium",children:["Estoque: ",s.stock," ",s.unit]}),s.stock<=s.min_stock&&e.jsx("p",{className:"text-sm text-red-500",children:"Estoque Baixo"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{variant:"ghost",size:"icon",children:e.jsx(te,{className:"h-4 w-4"})}),e.jsx(re,{title:"Excluir Produto",description:"Tem certeza que deseja excluir este produto? Esta ação não pode ser desfeita.",variant:"destructive",onConfirm:()=>r(s.id),children:e.jsx(v,{variant:"ghost",size:"icon",children:e.jsx(ee,{className:"h-4 w-4"})})})]})]})]}),s.tags&&s.tags.length>0&&e.jsx("div",{className:"mt-2 flex gap-2",children:s.tags.map(t=>e.jsx("span",{className:"px-2 py-1 rounded-full text-xs bg-gray-100",children:t},t))})]},s.id))})]})})]})}function ge({products:c,stockData:r}){const l=()=>c.filter(i=>i.type==="product"&&i.stock<=i.min_stock);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(h,{children:[e.jsx(j,{children:e.jsx(p,{children:"Total de Itens"})}),e.jsx(g,{children:e.jsx("p",{className:"text-2xl font-bold",children:c.length})})]}),e.jsxs(h,{children:[e.jsx(j,{children:e.jsx(p,{children:"Produtos"})}),e.jsx(g,{children:e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:c.filter(i=>i.type==="product").length})})]}),e.jsxs(h,{children:[e.jsx(j,{children:e.jsx(p,{children:"Serviços"})}),e.jsx(g,{children:e.jsx("p",{className:"text-2xl font-bold text-green-600",children:c.filter(i=>i.type==="service").length})})]}),e.jsxs(h,{children:[e.jsx(j,{children:e.jsx(p,{children:"Estoque Baixo"})}),e.jsx(g,{children:e.jsx("p",{className:"text-2xl font-bold text-red-600",children:l().length})})]})]}),e.jsx("div",{className:"mt-6",children:e.jsxs(h,{children:[e.jsxs(j,{children:[e.jsx(p,{children:"Movimentação de Estoque"}),e.jsx($,{children:"Quantidade em estoque por mês"})]}),e.jsx(g,{className:"h-[300px]",children:e.jsx(ie,{width:"100%",height:"100%",children:e.jsxs(ae,{data:r,children:[e.jsx(oe,{strokeDasharray:"3 3"}),e.jsx(ce,{dataKey:"month"}),e.jsx(le,{}),e.jsx(ne,{}),e.jsx(de,{dataKey:"quantity",fill:"#4F46E5"})]})})})]})})]})}function De(){const{toast:c}=V(),[r,l]=n.useState([]),[i,d]=n.useState([]),[m,a]=n.useState(""),[x,s]=n.useState("all"),[t,q]=n.useState("all"),[D,y]=n.useState(!0),{execute:A}=C(S.products.list),{execute:B}=C(S.products.create),{execute:F}=C(S.products.delete),{execute:L}=C(S.products.search);n.useEffect(()=>{P()},[]);const P=async()=>{try{y(!0);const o=await A();l(o);const N=o.filter(u=>u.type==="product").reduce((u,b)=>{const E=me(new Date(b.created_at),"MMM");return u[E]=(u[E]||0)+(b.stock||0),u},{});d(Object.entries(N).map(([u,b])=>({month:u,quantity:b})))}catch(o){console.error("Error loading products:",o)}finally{y(!1)}},M=async o=>{try{await B(o),c({title:"Produto cadastrado com sucesso!",description:"O item foi adicionado ao catálogo."}),P()}catch(N){console.error("Error creating product:",N)}},z=async o=>{try{await F(o),c({title:"Produto excluído com sucesso!",description:"O item foi removido do catálogo."}),P()}catch(N){console.error("Error deleting product:",N)}},O=async()=>{try{y(!0);const o=await L({term:m,category:x,stock:t});l(o)}catch(o){console.error("Error searching products:",o)}finally{y(!1)}};return n.useEffect(()=>{const o=setTimeout(O,300);return()=>clearTimeout(o)},[m,x,t]),D?e.jsx(_,{}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Produtos e Serviços"}),e.jsx("p",{className:"text-muted-foreground",children:"Gerencie seu catálogo"})]}),e.jsxs(W,{defaultValue:"dashboard",className:"space-y-4",children:[e.jsxs(X,{children:[e.jsx(T,{value:"dashboard",children:"Dashboard"}),e.jsx(T,{value:"register",children:"Cadastrar"}),e.jsx(T,{value:"list",children:"Catálogo"})]}),e.jsx(k,{value:"dashboard",children:e.jsx(ge,{products:r,stockData:i})}),e.jsx(k,{value:"register",children:e.jsx(he,{onSubmit:M})}),e.jsx(k,{value:"list",children:e.jsx(pe,{products:r,onDelete:z,searchTerm:m,setSearchTerm:a,selectedCategory:x,setSelectedCategory:s,stockFilter:t,setStockFilter:q})})]})]})}export{De as default};
